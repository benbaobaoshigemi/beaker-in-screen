# 物理模型说明文档

本文档详细说明 **Beaker In Screen** 化学反应粒子模拟器的物理模型、数学推导和实现细节。

---

## 目录

1. [系统概述](#1-系统概述)
2. [单位系统](#2-单位系统)
3. [粒子动力学](#3-粒子动力学)
4. [碰撞检测与处理](#4-碰撞检测与处理)
5. [化学反应模型](#5-化学反应模型)
6. [热力学自洽性](#6-热力学自洽性)
7. [恒温器](#7-恒温器)
8. [验证与校准](#8-验证与校准)

---

## 1. 系统概述

### 1.1 模拟架构

本模拟器采用**分子动力学**方法，在三维周期性边界条件下模拟硬球粒子的运动和化学反应。

```
┌─────────────────────────────────────┐
│     3D 周期性边界盒子 (PBC)          │
│                                     │
│    ● A粒子  ○ B粒子                  │
│                                     │
│    碰撞 → 反应判定 → 能量/动量更新    │
│                                     │
└─────────────────────────────────────┘
```

### 1.2 支持的反应类型

| 反应级数 | 触发机制 | 示例 |
|----------|----------|------|
| 二级反应 | 碰撞触发 | 2A → B, A + B → C + D |
| 一级反应 | 自发分解 | B → 2A, C → A + B |

### 1.3 核心物理假设

1. **硬球模型**：粒子为刚性球体，无长程相互作用
2. **阿伦尼乌斯动力学**：反应速率 k = A × exp(-Ea/kT)
3. **能量阈值**：碰撞能量 ≥ 活化能时反应发生
4. **即时碰撞**：碰撞过程瞬时完成

---

## 2. 单位系统

### 2.1 基本单位

本模拟采用**无量纲化单位系统**，设计目标是使物理量数值在 O(1) 量级。

| 物理量 | 符号 | 默认值 | 意义 |
|--------|------|--------|------|
| 质量 | m | 1.0 | 粒子质量单位 |
| 长度 | L | 1.0 | 盒子尺寸约 10-40 |
| 时间 | τ | 1.0 | dt = 0.002 |
| 温度 | T | 300 | 开尔文 (实际物理单位) |
| 玻尔兹曼常数 | k_B | 0.1 | 模拟单位 |

### 2.2 能量标度

关键设计：使 **热能 k_B T** 与 **活化能 E_a** 在同一量级。

```
T = 300K, k_B = 0.1
→ k_B T = 30 (模拟能量单位)

典型活化能 E_a = 20-30
→ E_a / (k_B T) = 0.67-1.0
→ 阿伦尼乌斯因子 exp(-E_a/k_B T) = 0.37-0.51
```

### 2.3 速度标度

Maxwell-Boltzmann 分布的标准差：

$$
\sigma_v = \sqrt{\frac{k_B T}{m}} = \sqrt{\frac{0.1 \times 300}{1.0}} \approx 5.48
$$

典型速度范围：v ∈ [-15, +15]

---

## 3. 粒子动力学

### 3.1 位置更新

采用简单 Euler 积分：

$$
\vec{r}(t + \Delta t) = \vec{r}(t) + \vec{v}(t) \cdot \Delta t
$$

周期性边界条件包装：

$$
\vec{r} \leftarrow \vec{r} \mod L_{box}
$$

### 3.2 速度初始化

粒子速度从 Maxwell-Boltzmann 分布采样：

$$
P(v_i) = \sqrt{\frac{m}{2\pi k_B T}} \exp\left(-\frac{m v_i^2}{2 k_B T}\right)
$$

消除系统漂移：

$$
\vec{v}_i \leftarrow \vec{v}_i - \langle \vec{v} \rangle
$$

### 3.3 温度定义

由能量均分定理：

$$
\langle E_k \rangle = \frac{3}{2} k_B T
$$

即：

$$
T = \frac{m \langle v^2 \rangle}{3 k_B} = \frac{m \sum_i |\vec{v}_i|^2}{3 N k_B}
$$

---

## 4. 碰撞检测与处理

### 4.1 Cell-Linked List 算法

为高效检测碰撞，使用空间分区算法：

```
1. 将盒子划分为 cell_divs³ 个单元格
2. cell_size = L_box / cell_divs ≥ 3 × r_max
3. 每个粒子只与相邻 27 个单元格内的粒子检查碰撞
4. 复杂度从 O(N²) 降为 O(N)
```

### 4.2 最小镜像惯例

在周期性边界下计算粒子间距离：

```python
dx = x_i - x_j
if dx > L/2:  dx -= L
if dx < -L/2: dx += L
# 类似处理 dy, dz
```

### 4.3 碰撞判定

两粒子碰撞条件：

$$
|\vec{r}_i - \vec{r}_j| < r_i + r_j \quad \text{且} \quad \vec{v}_{rel} \cdot \hat{n} < 0
$$

其中 $\hat{n}$ 是连心方向单位向量。

### 4.4 弹性碰撞

对于等质量粒子的弹性碰撞，法向速度分量交换：

$$
\vec{v}_i' = \vec{v}_i - v_n \hat{n}
$$
$$
\vec{v}_j' = \vec{v}_j + v_n \hat{n}
$$

其中法向相对速度：

$$
v_n = (\vec{v}_i - \vec{v}_j) \cdot \hat{n}
$$

---

## 5. 化学反应模型

### 5.1 二级反应（碰撞触发）

对于反应 **2A → B** 或 **A + B → C + D**：

#### 5.1.1 碰撞能量

碰撞时的法向动能（在质心系中）：

$$
E_{coll} = \frac{1}{2} \mu v_n^2 = \frac{1}{2} \cdot \frac{m}{2} \cdot v_n^2 = \frac{m v_n^2}{4}
$$

其中约化质量 $\mu = m_1 m_2 / (m_1 + m_2) = m/2$（等质量）。

#### 5.1.2 反应判定

阿伦尼乌斯阈值判定：

$$
\text{反应发生} \iff E_{coll} \geq E_a^{forward}
$$

#### 5.1.3 反应热处理

设反应热 $Q = E_a^{reverse} - E_a^{forward}$：
- Q > 0：放热反应
- Q < 0：吸热反应

能量守恒要求新的相对速度：

$$
v_n'^2 = v_n^2 + \frac{4Q}{m}
$$

速度更新：

$$
\vec{v}_i' = \vec{v}_i + \frac{v_n' - v_n}{2} \hat{n}
$$
$$
\vec{v}_j' = \vec{v}_j - \frac{v_n' - v_n}{2} \hat{n}
$$

### 5.2 一级反应（自发分解）

对于反应 **B → 2A**：

#### 5.2.1 反应概率

每个时间步，每个 B 粒子以概率 P 分解：

$$
P = A \cdot \exp\left(-\frac{E_a}{k_B T}\right) \cdot \Delta t
$$

其中频率因子 A 的计算见 [5.3 节](#53-频率因子的自洽性)。

#### 5.2.2 能量分配

分解时的动量守恒和能量守恒：

设原粒子速度 $\vec{v}$，分解沿随机方向 $\hat{d}$。

动量守恒：
$$
m\vec{v} = m\vec{v}_1 + m\vec{v}_2
$$

令 $\vec{v}_1 = \vec{v}/2 + \Delta v \cdot \hat{d}$，$\vec{v}_2 = \vec{v}/2 - \Delta v \cdot \hat{d}$

能量守恒：
$$
\frac{1}{2}m|\vec{v}_1|^2 + \frac{1}{2}m|\vec{v}_2|^2 = \frac{1}{2}m|\vec{v}|^2 + Q
$$

求解得：
$$
\Delta v = \sqrt{\frac{Q}{m} + \frac{|\vec{v}|^2}{4}}
$$

若 $Q + \frac{m|\vec{v}|^2}{4} < 0$（吸热反应且动能不足），反应不发生。

### 5.3 频率因子的自洽性

为确保热力学一致性（平衡常数正确），一级逆反应的频率因子 A 必须与二级正反应的碰撞频率匹配。

#### 推导

**二级反应速率**（碰撞论）：

$$
\frac{dN_B}{dt} = \frac{N_A^2 \cdot \sigma \cdot \bar{v}_{rel}}{2V} \cdot \exp\left(-\frac{E_a^f}{k_B T}\right)
$$

因子 2 来自避免重复计数碰撞对。

**一级逆反应速率**：

$$
-\frac{dN_B}{dt} = N_B \cdot A \cdot \exp\left(-\frac{E_a^r}{k_B T}\right)
$$

**平衡条件**：

$$
\frac{N_A^2 \cdot \sigma \cdot \bar{v}_{rel}}{2V} \cdot e^{-E_a^f/k_B T} = N_B \cdot A \cdot e^{-E_a^r/k_B T}
$$

**自洽条件**：

要求浓度平衡常数 $K_c = \frac{N_B \cdot V}{N_A^2} = e^{-\Delta E_a / k_B T}$

解得：

$$
\boxed{A = \frac{\sigma \cdot \bar{v}_{rel}}{2}}
$$

其中：
- 碰撞截面 $\sigma = \pi (2r)^2$
- 平均相对速度 $\bar{v}_{rel} = \sqrt{2} \cdot \bar{v} = \sqrt{\frac{16 k_B T}{\pi m}}$

---

## 6. 热力学自洽性

### 6.1 平衡常数

对于反应 **2A ⇌ B**：

浓度平衡常数：
$$
K_c = \frac{[B]}{[A]^2} = \frac{N_B / V}{(N_A / V)^2} = \frac{N_B \cdot V}{N_A^2}
$$

模拟验证结果：

| T (K) | K_sim | K_theory = exp(-ΔE_a/k_B T) | 误差 |
|-------|-------|----------------------------|------|
| 300 | 1.49 | 1.40 | +6.6% |

### 6.2 熵效应（勒夏特列原理）

**问题**：分解反应（B → 2A）对应熵增，应该热力学有利。模型如何体现？

**答案**：熵效应通过碰撞频率的**体积依赖性**自然体现。

| 反应 | 速率 | V 依赖 |
|------|------|--------|
| 正反应 2A→B | ∝ N_A²/V | **∝ 1/V** |
| 逆反应 B→2A | ∝ N_B | **无 V 依赖** |

体积增大时：
- 正反应速率下降（粒子更难相遇）
- 逆反应速率不变
- 平衡向分解方向移动 ✓

**验证结果**：

| 体积 V | N_B/N_A 比值 | K_c |
|--------|--------------|-----|
| 1728 | 1.04 | 1.39 |
| 3375 | 0.73 | 1.50 |
| 8000 | 0.42 | 1.56 |

K_c 基本恒定，N_B/N_A 随 V 增大而减小，符合预期。

### 6.3 能量守恒

#### 二级反应

初态动能：$E_i = \frac{1}{2}\mu v_n^2$

末态动能：$E_f = \frac{1}{2}\mu v_n'^2 = \frac{1}{2}\mu v_n^2 + Q$

能量变化 = 反应热 Q ✓

#### 一级反应

分解产物总动能：
$$
E_f = m\left(\frac{|\vec{v}|^2}{4} + \Delta v^2\right) = m\left(\frac{|\vec{v}|^2}{4} + \frac{Q}{m} + \frac{|\vec{v}|^2}{4}\right) = \frac{m|\vec{v}|^2}{2} + Q = E_i + Q \quad \checkmark
$$

---

## 7. 恒温器

### 7.1 实现方式

采用 **Berendsen 类**速度缩放恒温器：

$$
\vec{v}_i \leftarrow \vec{v}_i \cdot \sqrt{\frac{T_{target}}{T_{current}}}
$$

为避免温度剧烈跳变，限制缩放因子：

$$
\lambda = \text{clamp}\left(\sqrt{\frac{T_{target}}{T_{current}}}, 0.99, 1.01\right)
$$

### 7.2 恒温 vs 绝热模式

| 模式 | 恒温器状态 | 物理意义 |
|------|-----------|----------|
| 恒温 | 开启 | 与热浴接触，温度恒定 |
| 绝热 | 关闭 | 隔热系统，可观察反应热 |

绝热模式下，放热反应会导致系统温度上升，吸热反应导致温度下降。

---

## 8. 验证与校准

### 8.1 阿伦尼乌斯验证

运行 `verify_arrhenius.py`：
- 测量不同温度下的反应速率常数 k
- 绘制 ln(k) vs 1/T（阿伦尼乌斯图）
- 验证斜率 = -E_a / k_B

### 8.2 平衡常数验证

运行 `verify_equilibrium.py`：
- 模拟至平衡态
- 测量 K_sim = N_B × V / N_A²
- 与理论 K_theory = exp(-ΔE_a / k_B T) 比较

### 8.3 校准历史

| 日期 | 问题 | 修正 | 结果 |
|------|------|------|------|
| 2024-12 | K 偏差 -82% | 添加 /2 因子于频率因子 A | 偏差降至 +6.6% |

---

## 附录：关键公式汇总

### A. 碰撞能量
$$E_{coll} = \frac{m v_n^2}{4}$$

### B. 自洽频率因子
$$A = \frac{\pi (2r)^2 \cdot \sqrt{16 k_B T / \pi m}}{2}$$

### C. 分解速度增量
$$\Delta v = \sqrt{\frac{Q}{m} + \frac{|\vec{v}|^2}{4}}$$

### D. 浓度平衡常数
$$K_c = \frac{N_B \cdot V}{N_A^2} = \exp\left(-\frac{E_a^f - E_a^r}{k_B T}\right)$$

---

*文档版本：1.0*
*最后更新：2024-12-16*
